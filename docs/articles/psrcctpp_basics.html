<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>psrcctpp basics • psrcctpp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="psrcctpp basics">
<meta name="description" content="Learn to retrieve and summarize CTPP data
">
<meta property="og:description" content="Learn to retrieve and summarize CTPP data
">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">psrcctpp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/psrcctpp_basics.html">psrcctpp basics</a></li>
    <li><a class="dropdown-item" href="../articles/tips_and_tricks.html">psrcctpp tips &amp; tricks</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>psrcctpp basics</h1>
            
      

      <div class="d-none name"><code>psrcctpp_basics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-ctpp-data">Why CTPP data?<a class="anchor" aria-label="anchor" href="#why-ctpp-data"></a>
</h2>
<p>Although it is derived from the American Community Survey (ACS), CTPP
includes data items that are not published in the ACS release, and at
scales substantially smaller than ACS Public Use Microdata (PUMS). As
with other ACS products, it is consistent across scales, supports
longitudinal analysis, and includes margins of error. It is the most
authoritative nationwide, Census Bureau source for transportation flow
data in particular.</p>
<p>The primary drawback to CTPP data is the approximately 3-year lag to
develop it; since it’s restricted to non-overlapping 5-year spans, it
may involve a remove of nearly seven years from the conclusion of the
first year in a reported span. Issues such as the transportation impacts
accompanying the 2020 Covid pandemic have a long signature in the data
(i.e. the next data without it would arrive around 2029).</p>
</div>
<div class="section level2">
<h2 id="identify-and-retrieve-ctpp-data">Identify and retrieve CTPP data<a class="anchor" aria-label="anchor" href="#identify-and-retrieve-ctpp-data"></a>
</h2>
<div class="section level3">
<h3 id="determine-which-table-to-request">Determine which table to request<a class="anchor" aria-label="anchor" href="#determine-which-table-to-request"></a>
</h3>
<p>In order to request data, as with the ACS, one must know the CTPP
table code (or variable codes). To assist in identifying this, the
package has a search function, <a href="https://psrc.github.io/psrcctpp/reference/ctpp_tblsearch.html"><strong><code>ctpp_tblsearch()</code></strong></a>.
It has two required parameters:</p>
<ul>
<li><p><strong>prefix</strong> - CTPP uses a pattern in table names: the
first character denotes whether a table is originally reported data
(“A”; confidential data is suppressed) or perturbed (“B”; some noise
infusion instead of suppression), and the second indicates either
residence geography (“1”), workplace geography (“2”), or flows (“3”,
i.e. both residence and workplace geography). For example, a table for
original workplace geography uses the prefix “A2”. The function argument
can also use a question mark in place of these characters, if you’re not
particular about one or the other (or either), i.e. “?3” would show all
relevant flow tables, regardless of whether they are original or
perturbed data.</p></li>
<li><p><strong>“regex”</strong> - This is the regular expression search
term to find in the table description. It is not
case-sensitive.</p></li>
<li><p>(optional) <strong>year</strong> - i.e. specify which survey;
otherwise defaults to latest (currently 2012-16)</p></li>
</ul>
<p>In our example, we’re looking for a workplace-geography table showing
mode, aka “means of transportation” in Census parlance.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shhh</span> <span class="op">&lt;-</span> <span class="va">suppressPackageStartupMessages</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://psrc.github.io/psrcctpp/">psrcctpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ctpp_tblsearch.html">ctpp_tblsearch</a></span><span class="op">(</span><span class="st">"?2"</span>, <span class="st">"means of transp."</span>, year<span class="op">=</span><span class="fl">2016</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">description</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       name                                                     description</span></span>
<span><span class="co">##     &lt;char&gt;                                                          &lt;char&gt;</span></span>
<span><span class="co">## 1: A202105                              Workers by means of transportation</span></span>
<span><span class="co">## 2: B202200      Workers by minority status and by means of transportation </span></span>
<span><span class="co">## 3: B202202                   Workers by age and by means of transportation</span></span>
<span><span class="co">## 4: B202213           Workers by travel time and by means of transportation</span></span>
<span><span class="co">## 5: B202216 Workers by time arriving at work and by means of transportation</span></span>
<span><span class="co">## 6: B202222       Workers by employment type and by means of transportation</span></span></code></pre>
<p>In our example, the first table (A202105) is the one we’re after.
Notice, even if your attribute of interest is listed secondarily, there
will typically be subtotals by that dimension alone within the
table.</p>
</div>
<div class="section level3">
<h3 id="get-the-data">Get the data<a class="anchor" aria-label="anchor" href="#get-the-data"></a>
</h3>
<p>Once we’ve identified the table code, we can now use the <a href="https://psrc.github.io/psrcctpp/reference/get_psrc_ctpp.html"><strong><code>get_psrc_ctpp()</code></strong></a>
function to retrieve the data. Its parameters are:</p>
<ul>
<li>
<strong>scale</strong> - for residence or workplace tables, either
“county”, “place”, or “tract”<br>
for flow tables, either “county-county”, “place-place”, “place-county”,
“county-place”, or “tract-tract”<br>
“block group” scale will be available starting with the 2017-21
survey.<br>
</li>
<li>
<strong>table_code</strong> - identifier (string) for the table you
want (you can also request individual variables)</li>
<li>
<strong>dyear</strong> - aka data year, the last year of the CTPP
span (i.e. 2016 for 2012-16)</li>
</ul>
<p>By default, the resulting dataframe is restricted to geographies
within the Central Puget Sound region (or flows with one end within the
region). To specify a narrower set–or geographies outside the region–you
can provide a character vector using the optional
<strong>geoids</strong> argument containing the desired FIPS codes.</p>
<p>Notice that all results will include both res_geoid, res_label and
work_geoid, work_label fields, but the work fields will be
<code>NA</code> for residential tables and the residence fields will be
<code>NA</code> for workplace tables. Categorical fields are left as
character rather than factor datatype. Suppressed values in original
data (“A”) tables are also coded <code>NA</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_psrc_ctpp.html">get_psrc_ctpp</a></span><span class="op">(</span><span class="st">"tract"</span>, <span class="st">"A202105"</span>, <span class="fl">2016</span><span class="op">)</span>            <span class="co"># get data</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">x</span>, work_label<span class="op">=</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">work_label</span>, <span class="fl">7L</span>, <span class="fl">14L</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="co"># fit in frame</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>                   </span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;work_label, work_geoid, category&gt;</span></span>
<span><span class="co">##     work_geoid work_label                                    category estimate</span></span>
<span><span class="co">##         &lt;char&gt;     &lt;char&gt;                                      &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">## 1: 53033000100    Tract 1                                     Bicycle       NA</span></span>
<span><span class="co">## 2: 53033000100    Tract 1                          Bus or trolley bus      205</span></span>
<span><span class="co">## 3: 53033000100    Tract 1           Car, truck, or van -- Drove alone      900</span></span>
<span><span class="co">## 4: 53033000100    Tract 1 Car, truck, or van -- In a 2-person carpool       70</span></span>
<span><span class="co">## 5: 53033000100    Tract 1 Car, truck, or van -- In a 3-person carpool       NA</span></span>
<span><span class="co">## 6: 53033000100    Tract 1 Car, truck, or van -- In a 4-person carpool       NA</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="aggregate-ctpp-data-using-custom-variables">Aggregate CTPP data using custom variables<a class="anchor" aria-label="anchor" href="#aggregate-ctpp-data-using-custom-variables"></a>
</h2>
<p>CTPP data tables include totals as well as category breakdowns, but
if you wish to define either a custom category or a custom geography (as
an aggregate of a smaller geography, e.g. tract or block group), you can
create your own grouping variable, and then summarize using that
variable in the <a href="https://psrc.github.io/psrcctpp/reference/ctpp_stat.html"><strong><code>psrc_ctpp_sum()</code></strong></a>
function, as follows.</p>
<p><strong><code><a href="../reference/ctpp_stat.html">psrc_ctpp_sum()</a></code></strong> results include both
estimates and corresponding margins of error. The
<strong><code>incl_na=FALSE</code></strong> option can be used to remove
irrelevant categories without having to create a separate filtered data
object first (<code>NA</code> values for relevant categories are still
preserved).</p>
<p>You can utilize the convenience function <a href="https://psrc.github.io/psrcctpp/reference/ctpp_shares.html"><strong><code>ctpp_shares()</code></strong></a>
to append the share and share MOE to any CTPP dataset as long as it
contains category totals (as is typically the case).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  custom_geo<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">work_geoid</span>,<span class="fl">4L</span>,<span class="fl">11L</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"3302380"</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>         <span class="op">~</span> <span class="st">"Downtown Bellevue"</span>,</span>
<span>     <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">work_geoid</span>,<span class="fl">4L</span>,<span class="fl">11L</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"61040"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>,<span class="st">"00"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Downtown Everett"</span>,</span>
<span>     <span class="cn">TRUE</span>                                                          <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>  category<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">" carpool$"</span>,                       <span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="st">"Carpool"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Drove alone"</span>,                     <span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="st">"Drove Alone"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Streetcar|Bus|Subway|Ferry|Rail"</span>, <span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="st">"Transit"</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Bicycle|Walked"</span>,                  <span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="st">"Bike/Ped"</span>,</span>
<span>              <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="va">category</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctpp_stat.html">psrc_ctpp_sum</a></span><span class="op">(</span><span class="va">x</span>, group_vars<span class="op">=</span><span class="st">"custom_geo"</span>, incl_na<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ctpp_shares.html">ctpp_shares</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   custom_geo        category     estimate estimate_moe   share share_moe</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Downtown Bellevue Bike/Ped         <span style="text-decoration: underline;">2</span>300        451.  0.064<span style="text-decoration: underline;">3</span>    0.012<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Downtown Bellevue Carpool          <span style="text-decoration: underline;">3</span>960         <span style="color: #BB0000;">NA</span>   0.111    <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Downtown Bellevue Drove Alone     <span style="text-decoration: underline;">23</span>440       <span style="text-decoration: underline;">1</span>217.  0.655     0.020<span style="text-decoration: underline;">7</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Downtown Bellevue Motorcycle        110         61.4 0.003<span style="text-decoration: underline;">07</span>   0.001<span style="text-decoration: underline;">71</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Downtown Bellevue Other method      235         98.8 0.006<span style="text-decoration: underline;">57</span>   0.002<span style="text-decoration: underline;">75</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Downtown Bellevue Taxicab             0         <span style="color: #BB0000;">NA</span>   0        <span style="color: #BB0000;">NA</span></span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Craig Helmann, Suzanne Childress, Christy Lam, Chris Peak, Michael Jensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
