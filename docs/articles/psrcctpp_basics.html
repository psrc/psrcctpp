<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn to retrieve and summarize CTPP data
">
<title>psrcctpp basics • psrcctpp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="psrcctpp basics">
<meta property="og:description" content="Learn to retrieve and summarize CTPP data
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">psrcctpp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/psrcctpp_basics.html">psrcctpp basics</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>psrcctpp basics</h1>
            
      
      
      <div class="d-none name"><code>psrcctpp_basics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="why-ctpp-data">Why CTPP data?<a class="anchor" aria-label="anchor" href="#why-ctpp-data"></a>
</h2>
<p>Although it is derived from the American Community Survey (ACS), CTPP
includes data items that are not published in the ACS release, and at
scales substantially smaller than ACS Public Use Microdata (PUMS). As
with other ACS products, it is consistent across scales, supports
longitudinal analysis, and includes margins of error. It is the most
authoritative nationwide, Census Bureau source for transportation flow
data in particular.</p>
<p>The primary drawback to CTPP data is the approximately 3-year lag to
develop it; since it’s restricted to non-overlapping 5-year spans, it
may involve a remove of nearly seven years from the conclusion of the
first year in a reported span. Issues such as the transportation impacts
accompanying the 2020 Covid pandemic have a long signature in the data
(i.e. the next data without it would arrive around 2029).</p>
</div>
<div class="section level2">
<h2 id="retrieve-ctpp-data">Retrieve CTPP data<a class="anchor" aria-label="anchor" href="#retrieve-ctpp-data"></a>
</h2>
<p>The psrcctpp package retrieves data one table at a time, with the
<strong><code><a href="../reference/get_psrc_ctpp.html">get_psrc_ctpp()</a></code></strong> function. Its parameters
are:</p>
<ul>
<li>
<strong>scale</strong> - for residence or workplace tables, either
“county”, “place”, or “tract” for flow tables, either “county-county”,
“place-place”, “place-county”, “county-place”, or “tract-tract” “block
group” scale will be available starting with the 2017-21 survey.</li>
<li>
<strong>table_code</strong> - identifier (string) for the table you
want</li>
<li>
<strong>dyear</strong> - aka data year, the last year of the CTPP
span (i.e. 2016 for 2012-16)</li>
<li>(optional) list of <strong>geoids</strong> to restrict the table
further</li>
<li>(optional) network <strong>filepath</strong> if the API is
inoperable (use <code>"default"</code> unless you’ve saved another set;
this requires PSRC VPN).</li>
</ul>
<p>The result is a standard dataframe. Notice that all results will
include both res_geoid, res_label and work_geoid, work_label fields, but
the work fields will be blank for residential tables and the residence
fields will be blank for workplace tables. Strings are by default stored
as characters rather than Factor datatype.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shhh</span> <span class="op">&lt;-</span> <span class="va">suppressPackageStartupMessages</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://psrc.github.io/psrcctpp/">psrcctpp</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_psrc_ctpp.html">get_psrc_ctpp</a></span><span class="op">(</span><span class="st">"tract"</span>, <span class="st">"A202105"</span>, <span class="fl">2016</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    table_id                              work_label</span></span>
<span><span class="co">## 1:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">## 2:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">## 3:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">## 4:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">## 5:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">## 6:  A202105 Census Tract 1, King County, Washington</span></span>
<span><span class="co">##                                       category estimate estimate_moe</span></span>
<span><span class="co">## 1:                                     Bicycle       NA           NA</span></span>
<span><span class="co">## 2:                          Bus or trolley bus      205           96</span></span>
<span><span class="co">## 3:           Car, truck, or van -- Drove alone      900          244</span></span>
<span><span class="co">## 4: Car, truck, or van -- In a 2-person carpool       70           54</span></span>
<span><span class="co">## 5: Car, truck, or van -- In a 3-person carpool       NA           NA</span></span>
<span><span class="co">## 6: Car, truck, or van -- In a 4-person carpool       NA           NA</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="create-custom-variables-and-use-them-to-aggregate-ctpp-data">Create custom variables and use them to aggregate CTPP data<a class="anchor" aria-label="anchor" href="#create-custom-variables-and-use-them-to-aggregate-ctpp-data"></a>
</h2>
<p>CTPP data tables include totals as well as category breakdowns, but
if you wish to define either a custom category or a custom geography (as
an aggregate of a smaller geography, e.g. tract or block group), you can
create your own grouping variable, and then summarize using that
variable, as follows. Notice the <strong><code>incl_na=</code></strong>
option can be used to limit your results without needing to filter the
input data first.</p>
<p>You can utilize the convenience function
<strong><code><a href="../reference/ctpp_shares.html">ctpp_shares()</a></code></strong> to append the share and
share MOE to any CTPP dataset (as long as it contains category totals,
as is typically true).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shhh</span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/compound.html" class="external-link">%&lt;&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  custom_geo<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">work_geoid</span>,<span class="fl">4L</span>,<span class="fl">11L</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"3302380"</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>         <span class="op">~</span> <span class="st">"Downtown Bellevue"</span>,</span>
<span>               <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html" class="external-link">str_sub</a></span><span class="op">(</span><span class="va">work_geoid</span>,<span class="fl">4L</span>,<span class="fl">11L</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"61040"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>,<span class="st">"00"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Downtown Everett"</span>,</span>
<span>               <span class="cn">TRUE</span>                                                          <span class="op">~</span> <span class="cn">NA_character_</span><span class="op">)</span>,</span>
<span>  category<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">" carpool$"</span>, <span class="va">category</span><span class="op">)</span>                       <span class="op">~</span><span class="st">"Carpool"</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Drove alone"</span>, <span class="va">category</span><span class="op">)</span>                     <span class="op">~</span><span class="st">"Drove Alone"</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Streetcar|Bus|Subway|Ferry|Rail"</span>, <span class="va">category</span><span class="op">)</span> <span class="op">~</span><span class="st">"Transit"</span>,</span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"Bicycle|Walked"</span>, <span class="va">category</span><span class="op">)</span>                  <span class="op">~</span><span class="st">"Bike/Ped"</span>,</span>
<span>                     <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">category</span><span class="op">)</span>                                   <span class="op">~</span><span class="va">category</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ctpp_stat.html">psrc_ctpp_sum</a></span><span class="op">(</span><span class="va">x</span>, group_vars<span class="op">=</span><span class="st">"custom_geo"</span>, incl_na<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/ctpp_shares.html">ctpp_shares</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rs</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">##   custom_geo        category     estimate estimate_moe   share share_moe</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Downtown Bellevue Bike/Ped         <span style="text-decoration: underline;">2</span>300        451.  0.064<span style="text-decoration: underline;">3</span>    0.012<span style="text-decoration: underline;">3</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Downtown Bellevue Carpool          <span style="text-decoration: underline;">3</span>960         <span style="color: #BB0000;">NA</span>   0.111    <span style="color: #BB0000;">NA</span>      </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Downtown Bellevue Drove Alone     <span style="text-decoration: underline;">23</span>440       <span style="text-decoration: underline;">1</span>217.  0.655     0.020<span style="text-decoration: underline;">7</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Downtown Bellevue Motorcycle        110         61.4 0.003<span style="text-decoration: underline;">07</span>   0.001<span style="text-decoration: underline;">71</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Downtown Bellevue Other method      235         98.8 0.006<span style="text-decoration: underline;">57</span>   0.002<span style="text-decoration: underline;">75</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> Downtown Bellevue Taxicab             0         <span style="color: #BB0000;">NA</span>   0        <span style="color: #BB0000;">NA</span></span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Craig Helmann, Suzanne Childress, Christy Lam, Chris Peak, Michael Jensen.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
